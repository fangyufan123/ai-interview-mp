{"version":3,"file":"api.js","sources":["utils/api.js"],"sourcesContent":["\r\n\r\nconst BASE_URL = 'http://127.0.0.1:8080'\r\nexport const request = (options) =>{\r\n\treturn new Promise((resolve,reject) => {\r\n\t\tlet expire_time = uni.getStorageSync('login_expire_time');\r\n\t\tif(expire_time && expire_time < new Date().getTime()){\r\n\t\t\thandleRequest(options,resolve,reject)\r\n\t\t}else{\r\n\t\t\tuni.login({\r\n\t\t\t  provider: 'weixin', //使用微信登录\r\n\t\t\t  success: function (loginRes) {\r\n\t\t\t    uni.request({\r\n\t\t\t        url: BASE_URL+'/mp/login', //仅为示例，并非真实接口地址。\r\n\t\t\t        data: {\r\n\t\t\t            code: loginRes.code\r\n\t\t\t        },\r\n\t\t\t\t\tmethod:\"POST\",\r\n\t\t\t        header: {\r\n\t\t\t            'content-type': 'application/x-www-form-urlencoded' //自定义请求头信息\r\n\t\t\t        },\r\n\t\t\t        success: (res) => {\r\n\t\t\t            console.log(res.data);\r\n\t\t\t\t\t\tuni.setStorage({\r\n\t\t\t\t\t\t\tkey: 'user_info',\r\n\t\t\t\t\t\t\tdata: res.data.data,\r\n\t\t\t\t\t\t\tsuccess: function () {\r\n\t\t\t\t\t\t\t\tuni.setStorage({\r\n\t\t\t\t\t\t\t\t\tkey:'login_expire_time',\r\n\t\t\t\t\t\t\t\t\tdata: new Date().getTime() + 3600*1000\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\thandleRequest(options,resolve,reject)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\r\n\t\t\t           \r\n\t\t\t        }\r\n\t\t\t    });\r\n\t\t\t\r\n\t\t\t  }\r\n\t\t\t});\r\n\t\t}\r\n\t\r\n\t\r\n\t\r\n\t})\r\n}\r\n\r\nexport const handleRequest = (options,resolve,reject) => {\r\n\tuni.request({\n\t\turl: BASE_URL+options.url, //仅为示例，并非真实接口地址。\n\t\tdata:options.data,\r\n\t\tmethod:options.method,\n\t\theader: {\n\t\t\t'content-type': 'application/json',\r\n\t\t\t//自定义请求头信息\n\t\t\t'openid':uni.getStorageSync('user_info').openid,\r\n\t\t\t'mp_token':uni.getStorageSync('user_info').session_key\r\n\t\t\r\n\t\t},\n\t\tsuccess: (res) => {\n\t\t\treturn resolve(res.data)\n\t\t},\r\n\t\tfail: error => {\r\n\t\t\treturn reject(error)\r\n\t\t},\r\n\t\tcomplete: () =>{\r\n\t\t\tuni.hideLoading()\r\n\t\t}\r\n\t\t\n\t});\n\r\n}\r\n\r\nexport const getAllBanners = () => {\n    return request({\n        url: '/mp/banners',\n        method: 'GET'\n    });\n};\n\nexport const getAllCategories = () => {\n    return request({\n        url: '/mp/categories',\n        method: 'GET'\n    });\n};"],"names":["uni"],"mappings":";;AAEA,MAAM,WAAW;AACV,MAAM,UAAU,CAAC,YAAW;AAClC,SAAO,IAAI,QAAQ,CAAC,SAAQ,WAAW;AACtC,QAAI,cAAcA,cAAAA,MAAI,eAAe,mBAAmB;AACxD,QAAG,eAAe,eAAc,oBAAI,KAAM,GAAC,QAAO,GAAG;AACpD,oBAAc,SAAQ,SAAQ,MAAM;AAAA,IACvC,OAAO;AACJA,oBAAAA,MAAI,MAAM;AAAA,QACR,UAAU;AAAA;AAAA,QACV,SAAS,SAAU,UAAU;AAC3BA,wBAAAA,MAAI,QAAQ;AAAA,YACR,KAAK,WAAS;AAAA;AAAA,YACd,MAAM;AAAA,cACF,MAAM,SAAS;AAAA,YAClB;AAAA,YACP,QAAO;AAAA,YACD,QAAQ;AAAA,cACJ,gBAAgB;AAAA;AAAA,YACnB;AAAA,YACD,SAAS,CAAC,QAAQ;AACdA,4BAAA,MAAA,MAAA,OAAA,sBAAY,IAAI,IAAI;AAC7BA,4BAAAA,MAAI,WAAW;AAAA,gBACd,KAAK;AAAA,gBACL,MAAM,IAAI,KAAK;AAAA,gBACf,SAAS,WAAY;AACpBA,gCAAAA,MAAI,WAAW;AAAA,oBACd,KAAI;AAAA,oBACJ,OAAM,oBAAI,KAAI,GAAG,QAAS,IAAG,OAAK;AAAA,kBAC3C,CAAS;AACD,gCAAc,SAAQ,SAAQ,MAAM;AAAA,gBACpC;AAAA,cACR,CAAO;AAAA,YAGK;AAAA,UACZ,CAAQ;AAAA,QAEF;AAAA,MACN,CAAI;AAAA,IACD;AAAA,EAIH,CAAE;AACF;AAEO,MAAM,gBAAgB,CAAC,SAAQ,SAAQ,WAAW;AACxDA,gBAAAA,MAAI,QAAQ;AAAA,IACX,KAAK,WAAS,QAAQ;AAAA;AAAA,IACtB,MAAK,QAAQ;AAAA,IACb,QAAO,QAAQ;AAAA,IACf,QAAQ;AAAA,MACP,gBAAgB;AAAA;AAAA,MAEhB,UAASA,cAAG,MAAC,eAAe,WAAW,EAAE;AAAA,MACzC,YAAWA,cAAG,MAAC,eAAe,WAAW,EAAE;AAAA,IAE3C;AAAA,IACD,SAAS,CAAC,QAAQ;AACjB,aAAO,QAAQ,IAAI,IAAI;AAAA,IACvB;AAAA,IACD,MAAM,WAAS;AACd,aAAO,OAAO,KAAK;AAAA,IACnB;AAAA,IACD,UAAU,MAAK;AACdA,oBAAAA,MAAI,YAAa;AAAA,IACjB;AAAA,EAEH,CAAE;AAEF;AAEY,MAAC,gBAAgB,MAAM;AAC/B,SAAO,QAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,EAChB,CAAK;AACL;AAEY,MAAC,mBAAmB,MAAM;AAClC,SAAO,QAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,EAChB,CAAK;AACL;;;"}